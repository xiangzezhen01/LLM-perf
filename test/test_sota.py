import os
import re

import numpy as np
import pandas as pd
import sys

from matplotlib import pyplot as plt

from Method.Scaling_method.sacling import Farseer, Chinchilla, Kaplan, combine_scaling, mix3_law, mix5_law, DC_law
import logging
import time
from sklearn.ensemble import RandomForestRegressor
import random
import matplotlib

#

# 'dense1_loss': 'dataset/process/dense1_loss_arch',
# 'dense3_loss': 'dataset/process/data_constain_dense',
# 'dense2_loss': 'dataset/process/dense2_loss_arch',
# 'moe_loss': 'dataset/process/moe_loss_arch',
# 'moe2_loss': 'dataset/process/moe2_routing',

"""


"""
system_dir_dict = {
    'dense1_loss': 'D:\\CodePycharm\\LLMs-Performance-Learning\\dataset\\extend\\dense1_loss_arch_nd_groups',
    'dense3_loss': 'D:\\CodePycharm\\LLMs-Performance-Learning\\dataset\\extend\\data_constain_dense_nd_groups',
    'dense2_loss': 'D:\\CodePycharm\\LLMs-Performance-Learning\\dataset\\extend\\dense2_loss_arch_nd_groups',
    'moe_loss': 'D:\\CodePycharm\\LLMs-Performance-Learning\\dataset\\extend\\moe_loss_arch_nd_groups',
    'moe2_loss': 'D:\\CodePycharm\\LLMs-Performance-Learning\\dataset\\extend\\moe2_routing_nd_groups',
    'dense4_loss': 'D:\\CodePycharm\\LLMs-Performance-Learning\\dataset\\extend\\data_mixlaw_dense23_nd_groups',
    'dense5_loss': 'D:\\CodePycharm\\LLMs-Performance-Learning\\dataset\\extend\\data_mixlaw_dense5_nd_groups',
    'dense6_loss': 'D:\\CodePycharm\\LLMs-Performance-Learning\\dataset\\extend\\chinchilla_nd_groups'
}
#

system_test_arch_dict = {
    'dense4_loss': [0.1, 0.9],
    'dense5_loss': [0.2, 0.4, 0.6, 0.8],
    'dense1_loss': [0.05, 0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9,
                    0.95],
    'dense3_loss': [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9],
    'dense2_loss': [0.1, 0.3, 0.5, 0.7, 0.9],
    'moe_loss': [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9],
    'moe2_loss': [0.1, 0.3, 0.5, 0.7, 0.9],
    'dense6_loss': [0.05, 0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9,
                    0.95]
}

all_nd_pair = {
    'dense4_loss': [(160000000, 30000000000), (70000000, 30000000000), (410000000, 30000000000)],
    'dense5_loss': [(160000000, 30000000000), (1000000000, 41000000000), (305000000, 30000000000),
                    (410000000, 30000000000), (70000000, 30000000000)],
    'dense1_loss': [(201228288.0, 1999929344.0), (201228288.0, 2828353536.0), (201228288.0, 3999891456.0),
                    (201228288.0, 5656641536.0), (201228288.0, 7999848448.0), (201228288.0, 11313430528.0),
                    (201228288.0, 15999959040.0), (201228288.0, 22627401728.0), (201228288.0, 31999672320.0),
                    (201228288.0, 45254328320.0), (201228288.0, 63999836160.0), (201228288.0, 90508886016.0),
                    (201228288.0, 128000000000.0), (201228288.0, 255999000000.0), (201228288.0, 1414201344.0),
                    (201228288.0, 181018000000.0), (201228288.0, 362038000000.0), (239005312.0, 1681784832.0),
                    (239005312.0, 4756733952.0), (239005312.0, 19027001344.0), (239005312.0, 13454082048.0),
                    (239005312.0, 1189150720.0), (239005312.0, 26908557312.0), (239005312.0, 215268000000.0),
                    (239005312.0, 9513566208.0), (239005312.0, 6727139328.0), (239005312.0, 152218000000.0),
                    (239005312.0, 3363471360.0), (239005312.0, 38054215680.0), (239005312.0, 107635000000.0),
                    (239005312.0, 76109185024.0), (239005312.0, 2378301440.0), (239005312.0, 430537000000.0),
                    (239005312.0, 304435000000.0), (239005312.0, 53817114624.0), (284207616.0, 1999929344.0),
                    (284207616.0, 2828353536.0), (284207616.0, 3999891456.0), (284207616.0, 5656641536.0),
                    (284207616.0, 7999848448.0), (284207616.0, 11313430528.0), (284207616.0, 15999959040.0),
                    (284207616.0, 22627401728.0), (284207616.0, 31999672320.0), (284207616.0, 45254328320.0),
                    (284207616.0, 63999836160.0), (284207616.0, 90508886016.0), (284207616.0, 128000000000.0),
                    (284207616.0, 999997440.0), (284207616.0, 181018000000.0), (284207616.0, 1414201344.0),
                    (284207616.0, 255999000000.0), (284207616.0, 362038000000.0), (336994944.0, 3363471360.0),
                    (336994944.0, 26908557312.0), (336994944.0, 2378301440.0), (336994944.0, 53817114624.0),
                    (336994944.0, 1681784832.0), (336994944.0, 215268000000.0), (336994944.0, 38054215680.0),
                    (336994944.0, 9513566208.0), (336994944.0, 76109185024.0), (336994944.0, 4756733952.0),
                    (336994944.0, 152218000000.0), (336994944.0, 1189150720.0), (336994944.0, 6727139328.0),
                    (336994944.0, 19027001344.0), (336994944.0, 107635000000.0), (336994944.0, 13454082048.0),
                    (336994944.0, 430537000000.0), (336994944.0, 304435000000.0), (397772800.0, 2828353536.0),
                    (397772800.0, 3999891456.0), (397772800.0, 5656641536.0), (397772800.0, 7999848448.0),
                    (397772800.0, 11313430528.0), (397772800.0, 15999959040.0), (397772800.0, 22627401728.0),
                    (397772800.0, 31999672320.0), (397772800.0, 45254328320.0), (397772800.0, 63999836160.0),
                    (397772800.0, 90508886016.0), (397772800.0, 128000000000.0), (397772800.0, 1999929344.0),
                    (397772800.0, 181018000000.0), (397772800.0, 1414201344.0), (397772800.0, 255999000000.0),
                    (397772800.0, 362036000000.0), (476931840.0, 1681784832.0), (476931840.0, 38054215680.0),
                    (476931840.0, 3363471360.0), (476931840.0, 1189150720.0), (476931840.0, 13454082048.0),
                    (476931840.0, 4756733952.0), (476931840.0, 6727139328.0), (476931840.0, 19027001344.0),
                    (476931840.0, 9513566208.0), (476931840.0, 215268000000.0), (476931840.0, 2378301440.0),
                    (476931840.0, 152218000000.0), (476931840.0, 107635000000.0), (476931840.0, 26908557312.0),
                    (476931840.0, 53817114624.0), (476931840.0, 304435000000.0), (476931840.0, 430537000000.0),
                    (476931840.0, 76109185024.0), (568468736.0, 5656641536.0), (568468736.0, 7999848448.0),
                    (568468736.0, 11313430528.0), (568468736.0, 15999959040.0), (568468736.0, 22627401728.0),
                    (568468736.0, 31999672320.0), (568468736.0, 45254328320.0), (568468736.0, 63999836160.0),
                    (568468736.0, 90508886016.0), (568468736.0, 128000000000.0), (568468736.0, 1999929344.0),
                    (568468736.0, 2828353536.0), (568468736.0, 3999891456.0), (568468736.0, 999997440.0),
                    (568468736.0, 181018000000.0), (568468736.0, 1414201344.0), (568468736.0, 255998000000.0),
                    (568468736.0, 362036000000.0), (676012032.0, 76109185024.0), (676012032.0, 2378301440.0),
                    (676012032.0, 9513566208.0), (676012032.0, 53817114624.0), (676012032.0, 19027001344.0),
                    (676012032.0, 107635000000.0), (676012032.0, 152218000000.0), (676012032.0, 3363471360.0),
                    (676012032.0, 6727139328.0), (676012032.0, 1189150720.0), (676012032.0, 1681784832.0),
                    (676012032.0, 38054215680.0), (676012032.0, 4756733952.0), (676012032.0, 13454082048.0),
                    (676012032.0, 26908557312.0), (676012032.0, 430537000000.0), (676012032.0, 304435000000.0),
                    (676012032.0, 215268000000.0), (798470400.0, 15999959040.0), (798470400.0, 22627401728.0),
                    (798470400.0, 31999672320.0), (798470400.0, 45254737920.0), (798470400.0, 63999836160.0),
                    (798470400.0, 90508886016.0), (798470400.0, 128000000000.0), (798470400.0, 1999929344.0),
                    (798470400.0, 2828353536.0), (798470400.0, 3999891456.0), (798470400.0, 5656641536.0),
                    (798470400.0, 7999848448.0), (798470400.0, 11313430528.0), (798470400.0, 1414201344.0),
                    (798470400.0, 362036000000.0), (798470400.0, 181018000000.0), (798470400.0, 255998000000.0),
                    (798470400.0, 511998000000.0), (956354688.0, 4756733952.0), (956354688.0, 2378301440.0),
                    (956354688.0, 19027001344.0), (956354688.0, 9513566208.0), (956354688.0, 53817114624.0),
                    (956354688.0, 3363471360.0), (956354688.0, 6727139328.0), (956354688.0, 1189150720.0),
                    (956354688.0, 13454082048.0), (956354688.0, 26908557312.0), (956354688.0, 107635000000.0),
                    (956354688.0, 1681784832.0), (956354688.0, 76108791808.0), (956354688.0, 215268000000.0),
                    (956354688.0, 152217000000.0), (956354688.0, 430537000000.0), (956354688.0, 304435000000.0),
                    (956354688.0, 38054068224.0), (1125938688.0, 31999721472.0), (1125938688.0, 45254737920.0),
                    (1125938688.0, 63999836160.0), (1125938688.0, 90508886016.0), (1125938688.0, 128000000000.0),
                    (1125938688.0, 1999929344.0), (1125938688.0, 2828353536.0), (1125938688.0, 3999891456.0),
                    (1125938688.0, 5656641536.0), (1125938688.0, 7999848448.0), (1125938688.0, 11313430528.0),
                    (1125938688.0, 15999959040.0), (1125938688.0, 22627401728.0), (1125938688.0, 999997440.0),
                    (1125938688.0, 181018000000.0), (1125938688.0, 1414201344.0), (1125938688.0, 255998000000.0),
                    (1125938688.0, 362036000000.0), (1338278400.0, 26908557312.0), (1338278400.0, 3363471360.0),
                    (1338278400.0, 38054068224.0), (1338278400.0, 13454082048.0), (1338278400.0, 2378301440.0),
                    (1338278400.0, 19027001344.0), (1338278400.0, 6727139328.0), (1338278400.0, 9513566208.0),
                    (1338278400.0, 1189150720.0), (1338278400.0, 76108791808.0), (1338278400.0, 53817114624.0),
                    (1338278400.0, 1681784832.0), (1338278400.0, 4756733952.0), (1338278400.0, 152217000000.0),
                    (1338278400.0, 215268000000.0), (1338278400.0, 107635000000.0), (1338278400.0, 304435000000.0),
                    (1338278400.0, 430537000000.0), (1608122368.0, 63999836160.0), (1608122368.0, 90508886016.0),
                    (1608122368.0, 128000000000.0), (1608122368.0, 1999929344.0), (1608122368.0, 2828353536.0),
                    (1608122368.0, 3999891456.0), (1608122368.0, 5656641536.0), (1608122368.0, 7999848448.0),
                    (1608122368.0, 11313430528.0), (1608122368.0, 15999959040.0), (1608122368.0, 22627024896.0),
                    (1608122368.0, 31999721472.0), (1608122368.0, 45254246400.0), (1608122368.0, 1414201344.0),
                    (1608122368.0, 181018000000.0), (1608122368.0, 255998000000.0), (1608122368.0, 362036000000.0),
                    (1911894528.0, 19027001344.0), (1911894528.0, 53817114624.0), (1911894528.0, 26908557312.0),
                    (1911894528.0, 1681784832.0), (1911894528.0, 13454082048.0), (1911894528.0, 9513566208.0),
                    (1911894528.0, 38054133760.0), (1911894528.0, 2378301440.0), (1911894528.0, 3363471360.0),
                    (1911894528.0, 6727139328.0), (1911894528.0, 1189150720.0), (1911894528.0, 4756733952.0),
                    (1911894528.0, 76108791808.0), (1911894528.0, 152217000000.0), (1911894528.0, 107635000000.0),
                    (1911894528.0, 304435000000.0), (1911894528.0, 215268000000.0), (2273495040.0, 1999929344.0),
                    (2273495040.0, 2828353536.0), (2273495040.0, 3999891456.0), (2273495040.0, 7999848448.0),
                    (2273495040.0, 11313430528.0), (2273495040.0, 15999959040.0), (2273495040.0, 22627024896.0),
                    (2273495040.0, 31999721472.0), (2273495040.0, 45254246400.0), (2273495040.0, 63999574016.0),
                    (2273495040.0, 90508886016.0), (2273495040.0, 128000000000.0), (2273495040.0, 1414201344.0),
                    (2273495040.0, 181018000000.0), (2697992704.0, 26908557312.0), (2697992704.0, 38054133760.0),
                    (2697992704.0, 2378301440.0), (2697992704.0, 4756733952.0), (2697992704.0, 13454082048.0),
                    (2697992704.0, 19027001344.0), (2697992704.0, 1681784832.0), (2697992704.0, 6727139328.0),
                    (2697992704.0, 9513566208.0), (2697992704.0, 3363471360.0), (2697992704.0, 76108791808.0),
                    (2697992704.0, 107635000000.0), (2697992704.0, 53817114624.0), (2697992704.0, 215268000000.0),
                    (2697992704.0, 152218000000.0), (3184435200.0, 1999929344.0), (3184435200.0, 2828353536.0),
                    (3184435200.0, 3999891456.0), (3184435200.0, 5656641536.0), (3184435200.0, 11313479680.0),
                    (3184435200.0, 15999959040.0), (3184435200.0, 22627024896.0), (3184435200.0, 31999721472.0),
                    (3184435200.0, 45254246400.0), (3184435200.0, 63999574016.0), (3184435200.0, 90508886016.0),
                    (3184435200.0, 128000000000.0), (3184435200.0, 7999848448.0), (3816352512.0, 4756733952.0),
                    (3816352512.0, 3363471360.0), (3816352512.0, 9513566208.0), (3816352512.0, 6727139328.0),
                    (3816352512.0, 26908557312.0), (3816352512.0, 2378301440.0), (3816352512.0, 19027197952.0),
                    (3816352512.0, 13454082048.0), (3816352512.0, 76108791808.0), (3816352512.0, 38054133760.0),
                    (3816352512.0, 53817114624.0), (3816352512.0, 152218000000.0), (3816352512.0, 107634000000.0),
                    (4504118400.0, 5656641536.0), (4504118400.0, 7999848448.0), (4504118400.0, 15999959040.0),
                    (4504118400.0, 63999574016.0), (4504118400.0, 2828353536.0), (4504118400.0, 11313479680.0),
                    (4504118400.0, 3999891456.0), (4504118400.0, 22627024896.0), (4504118400.0, 1999929344.0),
                    (4504118400.0, 31999721472.0), (4504118400.0, 45254574080.0), (4504118400.0, 90508886016.0),
                    (5354047488.0, 4756733952.0), (5354047488.0, 19027197952.0), (5354047488.0, 9513566208.0),
                    (5354047488.0, 13454213120.0), (5354047488.0, 6727139328.0), (5354047488.0, 3363471360.0),
                    (5354047488.0, 53817114624.0), (5354047488.0, 38054133760.0), (5354047488.0, 26908557312.0),
                    (5354047488.0, 107634000000.0), (5354047488.0, 76108791808.0), (6369572352.0, 7999848448.0),
                    (6369572352.0, 31999918080.0), (6369572352.0, 3999891456.0), (6369572352.0, 15999959040.0),
                    (6369572352.0, 45254574080.0), (6369572352.0, 1999929344.0), (6369572352.0, 5656641536.0),
                    (6369572352.0, 22627024896.0), (6369572352.0, 2828353536.0), (6369572352.0, 11313479680.0),
                    (6369572352.0, 90508886016.0), (99620352.0, 1999929344.0), (99620352.0, 2828353536.0),
                    (99620352.0, 3999891456.0), (99620352.0, 5656641536.0), (99620352.0, 7999848448.0),
                    (99620352.0, 11313430528.0), (99620352.0, 15999959040.0), (99620352.0, 22627401728.0),
                    (99620352.0, 31999672320.0), (99620352.0, 45254328320.0), (99620352.0, 63999836160.0),
                    (99620352.0, 90508886016.0), (99620352.0, 128000000000.0), (99620352.0, 181019000000.0),
                    (99620352.0, 255999000000.0), (118460160.0, 13454082048.0), (118460160.0, 26908557312.0),
                    (118460160.0, 53817114624.0), (118460160.0, 76109185024.0), (118460160.0, 9513566208.0),
                    (118460160.0, 6727139328.0), (118460160.0, 3363471360.0), (118460160.0, 19027001344.0),
                    (118460160.0, 2378301440.0), (118460160.0, 152218000000.0), (118460160.0, 107635000000.0),
                    (118460160.0, 4756733952.0), (118460160.0, 38054215680.0), (118460160.0, 215268000000.0),
                    (118460160.0, 1681784832.0), (140718592.0, 1999929344.0), (140718592.0, 2828353536.0),
                    (140718592.0, 3999891456.0), (140718592.0, 5656641536.0), (140718592.0, 7999848448.0),
                    (140718592.0, 11313430528.0), (140718592.0, 15999959040.0), (140718592.0, 22627401728.0),
                    (140718592.0, 31999672320.0), (140718592.0, 45254328320.0), (140718592.0, 63999836160.0),
                    (140718592.0, 90508886016.0), (140718592.0, 128000000000.0), (140718592.0, 181018000000.0),
                    (140718592.0, 1414201344.0), (140718592.0, 255999000000.0), (167299200.0, 1189150720.0),
                    (167299200.0, 1681784832.0), (167299200.0, 215268000000.0), (167299200.0, 6727139328.0),
                    (167299200.0, 3363471360.0), (167299200.0, 4756733952.0), (167299200.0, 2378301440.0),
                    (167299200.0, 9513566208.0), (167299200.0, 19027001344.0), (167299200.0, 107635000000.0),
                    (167299200.0, 53817114624.0), (167299200.0, 38054215680.0), (167299200.0, 13454082048.0),
                    (167299200.0, 26908557312.0), (167299200.0, 76109185024.0), (167299200.0, 304435000000.0),
                    (167299200.0, 152218000000.0), (2273495040.0, 430537310208.0), (2697992704.0, 430537310208.0),
                    (3816352512.0, 453197168640.0), (6369572352.0, 304437264384.0), (25120768000.0, 125599744000.0),
                    (5354047488.0, 215270162432.0), (5354047488.0, 430540062720.0)]
    ,
    'dense3_loss': [(1096300000.0, 100000000.0), (1096300000.0, 1500000000.0), (1096300000.0, 2700000000.0),
                    (1096300000.0, 3900000000.0), (1096300000.0, 5900000000.0), (1096300000.0, 7500000000.0),
                    (1096300000.0, 12000000000.0), (1096300000.0, 91000000000.0), (1096300000.0, 174000000000.0),
                    (1096300000.0, 250000000000.0), (7098752.0, 100000000.0), (7098752.0, 200000000.0),
                    (14100000.0, 100000000.0), (14100000.0, 200000000.0), (14100000.0, 400000000.0),
                    (14100000.0, 800000000.0), (14100000.0, 1500000000.0), (14100000.0, 2700000000.0),
                    (14100000.0, 3900000000.0), (14100000.0, 5900000000.0), (14100000.0, 7500000000.0),
                    (14100000.0, 14000000000.0), (14100000.0, 20000000000.0), (14100000.0, 91000000000.0),
                    (14100000.0, 174000000000.0), (14100000.0, 300000000000.0), (14100000.0, 600000000000.0),
                    (14100000.0, 900000000000.0), (146500000.0, 14000000000.0), (146500000.0, 60000000000.0),
                    (146500000.0, 91000000000.0), (146500000.0, 174000000000.0), (146500000.0, 1500000000.0),
                    (146500000.0, 2700000000.0), (146500000.0, 3900000000.0), (146500000.0, 5900000000.0),
                    (146500000.0, 7500000000.0), (146500000.0, 20000000000.0), (146500000.0, 32000000000.0),
                    (1517300000.0, 8800000000.0), (1517300000.0, 66000000000.0), (1517300000.0, 91000000000.0),
                    (1517300000.0, 174000000000.0), (2160013824.0, 46000000000.0), (2160013824.0, 91000000000.0),
                    (2160013824.0, 174000000000.0), (201236224.0, 1500000000.0), (220500000.0, 7500000000.0),
                    (220500000.0, 1500000000.0), (220500000.0, 2700000000.0), (220500000.0, 3900000000.0),
                    (220500000.0, 5900000000.0), (220500000.0, 60000000000.0), (220500000.0, 32000000000.0),
                    (220500000.0, 91000000000.0), (220500000.0, 174000000000.0), (220500000.0, 300000000000.0),
                    (220500000.0, 600000000000.0), (281000000.0, 5900000000.0), (281000000.0, 1500000000.0),
                    (281000000.0, 2700000000.0), (281000000.0, 3900000000.0), (281000000.0, 7500000000.0),
                    (281000000.0, 91000000000.0), (2810000000.0, 4000000000.0), (2810000000.0, 8000000000.0),
                    (2810000000.0, 12000000000.0), (2810000000.0, 16000000000.0), (2810000000.0, 24000000000.0),
                    (2810000000.0, 32000000000.0), (2810000000.0, 40000000000.0), (2810000000.0, 55000000000.0),
                    (2810000000.0, 100000000.0), (2810000000.0, 4800000000.0), (2810000000.0, 36000000000.0),
                    (2810000000.0, 77000000000.0), (421200000.0, 3900000000.0), (421200000.0, 1500000000.0),
                    (421200000.0, 2700000000.0), (421200000.0, 5900000000.0), (421200000.0, 7500000000.0),
                    (421200000.0, 32000000000.0), (421200000.0, 60000000000.0), (421200000.0, 91000000000.0),
                    (421200000.0, 250000000000.0), (421200000.0, 300000000000.0), (3899710720.0, 26000000000.0),
                    (4246500000.0, 12000000000.0), (4246500000.0, 24000000000.0), (4246500000.0, 36000000000.0),
                    (4246500000.0, 48000000000.0), (4246500000.0, 60000000000.0), (4246500000.0, 72000000000.0),
                    (4246500000.0, 84100000000.0), (4246500000.0, 84000000000.0), (35500000.0, 400000000.0),
                    (35500000.0, 200000000.0), (35500000.0, 800000000.0), (44000000.0, 200000000.0),
                    (44000000.0, 400000000.0), (44000000.0, 1500000000.0), (44000000.0, 2700000000.0),
                    (44000000.0, 3900000000.0), (44000000.0, 5900000000.0), (44000000.0, 7500000000.0),
                    (44000000.0, 14000000000.0), (44000000.0, 20000000000.0), (44000000.0, 32000000000.0),
                    (44000000.0, 91000000000.0), (44000000.0, 174000000000.0), (573700000.0, 174000000000.0),
                    (573700000.0, 300000000000.0), (573700000.0, 600000000000.0), (618700000.0, 2700000000.0),
                    (618700000.0, 1500000000.0), (618700000.0, 3900000000.0), (618700000.0, 5900000000.0),
                    (618700000.0, 7500000000.0), (618700000.0, 22000000000.0), (618700000.0, 60000000000.0),
                    (618700000.0, 91000000000.0), (82700000.0, 1500000000.0), (82700000.0, 20000000000.0),
                    (82700000.0, 400000000.0), (82700000.0, 2700000000.0), (82700000.0, 3900000000.0),
                    (82700000.0, 5900000000.0), (82700000.0, 7500000000.0), (82700000.0, 14000000000.0),
                    (82700000.0, 32000000000.0), (82700000.0, 60000000000.0), (82700000.0, 91000000000.0),
                    (82700000.0, 174000000000.0), (82700000.0, 300000000000.0), (8670000000.0, 178000000000.0),
                    (8670000000.0, 12000000000.0), (8670000000.0, 20000000000.0)],
    'dense2_loss': [(268304384, 80000000000), (268304384, 5000000000), (268304384, 14200000000),
                    (268304384, 25000000000), (536872960, 10000000000), (536872960, 28400000000),
                    (536872960, 50000000000), (429260800, 50000000000), (429260800, 8000000000),
                    (429260800, 22700000000), (429260800, 40000000000), (1073741824, 20000000000),
                    (1073741824, 56900000000), (214663680, 100000000000), (214663680, 4000000000),
                    (214663680, 11400000000), (214663680, 20000000000)],
    'moe_loss': [(2156188672, 2000000000), (2156188672, 4000000000), (2156188672, 8000000000),
                 (2156188672, 20000000000), (2155174912, 2000000000), (2155174912, 4000000000),
                 (2155174912, 8000000000), (2155174912, 20000000000), (2150612992, 2000000000),
                 (2150612992, 4000000000), (2150612992, 8000000000), (2150612992, 20000000000)],
    'moe2_loss': [(1308819456.0, 130000000000.0), (26677542912.0, 130000000000.0), (207077179392.0, 130000000000.0),
                  (52448919552.0, 130000000000.0), (103991672832.0, 130000000000.0), (26683837440.0, 130000000000.0),
                  (207083473920.0, 130000000000.0), (52455214080.0, 130000000000.0), (103997967360.0, 130000000000.0),
                  (13798149120.0, 130000000000.0), (13791854592.0, 130000000000.0), (4133882880.0, 130000000000.0),
                  (4127588352.0, 130000000000.0), (2523171840.0, 130000000000.0), (2516877312.0, 130000000000.0),
                  (1717816320.0, 130000000000.0), (1711521792.0, 130000000000.0), (7355304960.0, 130000000000.0),
                  (7349010432.0, 130000000000.0), (132163584.0, 130000000000.0), (401952768.0, 130000000000.0),
                  (2560223232.0, 130000000000.0), (5026818048.0, 130000000000.0), (2560826016.0, 130000000000.0),
                  (5027420832.0, 130000000000.0), (19826989728.0, 130000000000.0), (1326925824.0, 130000000000.0),
                  (19826386944.0, 130000000000.0), (248393376.0, 130000000000.0), (247790592.0, 130000000000.0),
                  (1327528608.0, 130000000000.0), (9960610464.0, 130000000000.0), (402555552.0, 130000000000.0),
                  (171312288.0, 130000000000.0), (170709504.0, 130000000000.0), (710879904.0, 130000000000.0),
                  (710277120.0, 130000000000.0), (60579840.0, 130000000000.0), (211611648.0, 130000000000.0),
                  (3232247808.0, 130000000000.0), (815738880.0, 130000000000.0), (1621241856.0, 130000000000.0),
                  (60678336.0, 130000000000.0), (815837376.0, 130000000000.0), (1621340352.0, 130000000000.0),
                  (3232346304.0, 130000000000.0), (211710144.0, 130000000000.0), (413085888.0, 130000000000.0),
                  (16527360.0, 130000000000.0), (412987392.0, 130000000000.0), (35506368.0, 130000000000.0),
                  (35407872.0, 130000000000.0), (111022272.0, 130000000000.0), (110923776.0, 130000000000.0),
                  (22920384.0, 130000000000.0), (22821888.0, 130000000000.0), (555892736.0, 130000000000.0),
                  (4314906624.0, 130000000000.0), (86016000.0, 130000000000.0), (287391744.0, 130000000000.0),
                  (27279360.0, 130000000000.0), (1092894720.0, 130000000000.0), (2166898688.0, 130000000000.0),
                  (159432704.0, 130000000000.0), (562184192.0, 130000000000.0), (1084506112.0, 130000000000.0),
                  (4306518016.0, 130000000000.0), (291586048.0, 130000000000.0), (1097089024.0, 130000000000.0),
                  (41963520.0, 130000000000.0), (144752640.0, 130000000000.0), (56647680.0, 130000000000.0),
                  (4315037952.0, 130000000000.0), (556024064.0, 130000000000.0), (35672064.0, 130000000000.0),
                  (52453376.0, 130000000000.0), (52584704.0, 130000000000.0), (86147328.0, 130000000000.0),
                  (287523072.0, 130000000000.0), (1093026048.0, 130000000000.0), (2167030016.0, 130000000000.0),
                  (35803392.0, 130000000000.0), (153272576.0, 130000000000.0), (153141248.0, 130000000000.0),
                  (368123904.0, 130000000000.0), (58128408576.0, 130000000000.0), (14638325760.0, 130000000000.0),
                  (5181480960.0, 130000000000.0), (1557307392.0, 130000000000.0), (29248266240.0, 130000000000.0),
                  (1160921088.0, 130000000000.0), (7503224832.0, 130000000000.0), (3935674368.0, 130000000000.0),
                  (14808195072.0, 130000000000.0), (481388544.0, 130000000000.0), (707899392.0, 130000000000.0),
                  (500256768.0, 130000000000.0), (764522496.0, 130000000000.0), (1953718272.0, 130000000000.0),
                  (1162691712.0, 130000000000.0), (3879051264.0, 130000000000.0), (709670016.0, 130000000000.0),
                  (14751571968.0, 130000000000.0), (58241654784.0, 130000000000.0), (58243425408.0, 130000000000.0),
                  (3880821888.0, 130000000000.0), (14753342592.0, 130000000000.0), (29250036864.0, 130000000000.0),
                  (2066964480.0, 130000000000.0), (2068735104.0, 130000000000.0), (7504995456.0, 130000000000.0),
                  (483159168.0, 130000000000.0), (57369600.0, 130000000000.0), (172083200.0, 130000000000.0),
                  (2138547200.0, 130000000000.0), (4236108800.0, 130000000000.0), (8431232000.0, 130000000000.0),
                  (565376000.0, 130000000000.0), (1089766400.0, 130000000000.0), (106534400.0, 130000000000.0),
                  (106790800.0, 130000000000.0), (172339600.0, 130000000000.0), (565632400.0, 130000000000.0),
                  (1090022800.0, 130000000000.0), (2138803600.0, 130000000000.0), (4236365200.0, 130000000000.0),
                  (8431488400.0, 130000000000.0), (74016400.0, 130000000000.0), (73760000.0, 130000000000.0),
                  (303437200.0, 130000000000.0), (303180800.0, 130000000000.0)],

    "dense6_loss": [(93940416, 134217728), (93940416, 268435456), (93940416, 402653184), (93940416, 536870912),
                    (93940416, 671088640), (93940416, 805306368), (93940416, 939524096), (93940416, 1073741824),
                    (93940416, 1207959552), (93940416, 1342177280), (93940416, 1476395008), (93940416, 1610612736),
                    (93940416, 1744830464), (93940416, 1879048192), (93940416, 2013265920), (93940416, 2147483648),
                    (93940416, 2281701376), (93940416, 2415919104), (93940416, 2550136832), (93940416, 2684354560),
                    (93940416, 2818572288), (93940416, 2952790016), (93940416, 3087007744), (93940416, 3221225472),
                    (93940416, 3355443200), (93940416, 3489660928), (93940416, 3623878656), (93940416, 3758096384),
                    (93940416, 3892314112), (93940416, 4026531840), (93940416, 4160749568), (93940416, 4294967296),
                    (93940416, 4429185024), (93940416, 4563402752), (93940416, 4697620480), (93940416, 4831838208),
                    (93940416, 4966055936), (93940416, 5100273664), (93940416, 5234491392), (93940416, 5368709120),
                    (93940416, 5502926848), (93940416, 5637144576), (93940416, 5771362304), (93940416, 5905580032),
                    (93940416, 6039797760), (93940416, 6174015488), (93940416, 6308233216), (93940416, 6442450944),
                    (93940416, 6576668672), (93940416, 6710886400), (93940416, 6845104128), (93940416, 6979321856),
                    (93940416, 7113539584), (93940416, 7247757312), (93940416, 7381975040), (93940416, 7516192768),
                    (93940416, 7650410496), (93940416, 7784628224), (93940416, 7918845952), (93940416, 8053063680),
                    (93940416, 8187281408), (93940416, 8321499136), (93940416, 8455716864), (93940416, 8589934592),
                    (93940416, 8724152320), (93940416, 8858370048), (93940416, 8992587776), (93940416, 9126805504),
                    (93940416, 9261023232), (93940416, 9395240960), (93940416, 9529458688), (93940416, 9663676416),
                    (93940416, 9797894144), (93940416, 9932111872), (93940416, 10066329600), (93940416, 10200547328),
                    (93940416, 10334765056), (93940416, 10468982784), (93940416, 10603200512), (93940416, 10737418240),
                    (93940416, 10871635968), (93940416, 11005853696), (93940416, 11140071424), (93940416, 11274289152),
                    (93940416, 11408506880), (93940416, 11542724608), (93940416, 11676942336), (93940416, 11811160064),
                    (93940416, 11945377792), (93940416, 12079595520), (93940416, 12213813248), (93940416, 12348030976),
                    (93940416, 12482248704), (93940416, 12616466432), (93940416, 12750684160), (93940416, 12884901888),
                    (93940416, 13019119616), (93940416, 13153337344), (93940416, 13287555072), (93940416, 13421772800),
                    (93940416, 13555990528), (93940416, 13690208256), (93940416, 13824425984), (93940416, 13958643712),
                    (93940416, 14092861440), (93940416, 14227079168), (93940416, 14361296896), (93940416, 14495514624),
                    (93940416, 14629732352), (93940416, 14763950080), (93940416, 14898167808), (93940416, 15032385536),
                    (93940416, 15166603264), (93940416, 15300820992), (93940416, 15435038720), (93940416, 15569256448),
                    (93940416, 15703474176), (93940416, 15837691904), (93940416, 15971909632), (93940416, 16106127360),
                    (93940416, 16240345088), (93940416, 16374562816), (93940416, 16508780544), (93940416, 16642998272),
                    (93940416, 16777216000), (57234240, 134217728), (57234240, 209715200), (57234240, 262144000),
                    (113718400, 134217728), (113718400, 268435456), (113718400, 402653184), (113718400, 536870912),
                    (113718400, 671088640), (113718400, 805306368), (113718400, 939524096), (113718400, 1073741824),
                    (113718400, 1207959552), (113718400, 1342177280), (113718400, 1476395008), (113718400, 1610612736),
                    (113718400, 1744830464), (113718400, 1879048192), (113718400, 2013265920), (113718400, 2147483648),
                    (113718400, 2281701376), (113718400, 2415919104), (113718400, 2550136832), (113718400, 2684354560),
                    (113718400, 2818572288), (113718400, 2952790016), (113718400, 3087007744), (113718400, 3221225472),
                    (113718400, 3355443200), (113718400, 3489660928), (113718400, 3623878656), (113718400, 3758096384),
                    (113718400, 3892314112), (113718400, 4026531840), (113718400, 4160749568), (113718400, 4294967296),
                    (113718400, 4429185024), (113718400, 4563402752), (113718400, 4697620480), (113718400, 4831838208),
                    (113718400, 4966055936), (113718400, 5100273664), (113718400, 5234491392), (113718400, 5368709120),
                    (113718400, 5502926848), (113718400, 5637144576), (113718400, 5771362304), (113718400, 5905580032),
                    (113718400, 6039797760), (113718400, 6174015488), (113718400, 6308233216), (113718400, 6442450944),
                    (113718400, 6576668672), (113718400, 6710886400), (113718400, 6845104128), (113718400, 6979321856),
                    (113718400, 7113539584), (113718400, 7247757312), (113718400, 7381975040), (113718400, 7516192768),
                    (113718400, 7650410496), (113718400, 7784628224), (113718400, 7918845952), (113718400, 8053063680),
                    (113718400, 8187281408), (113718400, 8321499136), (113718400, 8455716864), (113718400, 8589934592),
                    (113718400, 8724152320), (113718400, 8858370048), (113718400, 8992587776), (113718400, 9126805504),
                    (113718400, 9261023232), (113718400, 9395240960), (113718400, 9529458688), (113718400, 9663676416),
                    (113718400, 9797894144), (113718400, 9932111872), (113718400, 10066329600),
                    (113718400, 10200547328),
                    (113718400, 10334765056), (113718400, 10468982784), (113718400, 10603200512),
                    (113718400, 10737418240),
                    (113718400, 10871635968), (113718400, 11005853696), (113718400, 11140071424),
                    (113718400, 11274289152),
                    (113718400, 11408506880), (113718400, 11542724608), (113718400, 11676942336),
                    (113718400, 11811160064),
                    (113718400, 11945377792), (113718400, 12079595520), (113718400, 12213813248),
                    (113718400, 12348030976),
                    (113718400, 12482248704), (113718400, 12616466432), (113718400, 12750684160),
                    (113718400, 12884901888),
                    (113718400, 13019119616), (113718400, 13153337344), (113718400, 13287555072),
                    (113718400, 13421772800),
                    (113718400, 13555990528), (113718400, 13690208256), (113718400, 13824425984),
                    (113718400, 13958643712),
                    (113718400, 14092861440), (113718400, 14227079168), (113718400, 14361296896),
                    (113718400, 14495514624),
                    (113718400, 14629732352), (113718400, 14763950080), (113718400, 14898167808),
                    (113718400, 15032385536),
                    (113718400, 15166603264), (113718400, 15300820992), (113718400, 15435038720),
                    (113718400, 15569256448),
                    (113718400, 15703474176), (113718400, 15837691904), (113718400, 15971909632),
                    (113718400, 16106127360),
                    (113718400, 16240345088), (113718400, 16374562816), (113718400, 16508780544),
                    (113718400, 16642998272),
                    (113718400, 16777216000), (62052928, 134217728), (62052928, 268435456), (62052928, 402653184),
                    (62052928, 536870912), (62052928, 671088640), (62052928, 805306368), (62052928, 939524096),
                    (62052928, 1073741824), (62052928, 1207959552), (62052928, 1342177280), (62052928, 1476395008),
                    (62052928, 1610612736), (62052928, 1744830464), (62052928, 1879048192), (62052928, 2013265920),
                    (62052928, 2147483648), (62052928, 2281701376), (62052928, 2415919104), (62052928, 2550136832),
                    (62052928, 2684354560), (62052928, 2818572288), (62052928, 2952790016), (62052928, 3087007744),
                    (62052928, 3221225472), (62052928, 3355443200), (62052928, 3489660928), (62052928, 3623878656),
                    (62052928, 3758096384), (62052928, 3892314112), (62052928, 4026531840), (62052928, 4160749568),
                    (62052928, 4194304000), (93940416, 4194304000), (93940416, 1048576000), (93940416, 524288000),
                    (93940416, 1572864000), (93940416, 786432000), (93940416, 377487360), (93940416, 1310720000),
                    (93940416, 262144000), (93940416, 209715200), (113718400, 1310720000), (113718400, 2621440000),
                    (113718400, 1572864000), (113718400, 786432000), (113718400, 524288000), (113718400, 1887436800),
                    (113718400, 1048576000), (113718400, 2097152000), (113718400, 4194304000), (522374400, 268435456),
                    (522374400, 536870912), (522374400, 805306368), (522374400, 1073741824), (522374400, 1342177280),
                    (522374400, 1610612736), (522374400, 1879048192), (522374400, 2147483648), (522374400, 2415919104),
                    (522374400, 2684354560), (522374400, 2952790016), (522374400, 3145728000), (176576256, 134217728),
                    (176576256, 268435456), (176576256, 402653184), (176576256, 536870912), (176576256, 671088640),
                    (176576256, 805306368), (176576256, 939524096), (176576256, 1073741824), (176576256, 1207959552),
                    (176576256, 1342177280), (176576256, 1476395008), (176576256, 1610612736), (176576256, 1744830464),
                    (176576256, 1879048192), (176576256, 2013265920), (176576256, 2147483648), (176576256, 2281701376),
                    (176576256, 2415919104), (176576256, 2550136832), (176576256, 2684354560), (176576256, 2818572288),
                    (176576256, 2952790016), (176576256, 3087007744), (176576256, 3145728000), (176576256, 2097152000),
                    (176576256, 2621440000), (176576256, 1048576000), (176576256, 1572864000), (76816896, 134217728),
                    (76816896, 268435456), (76816896, 402653184), (76816896, 536870912), (76816896, 671088640),
                    (76816896, 805306368), (76816896, 939524096), (76816896, 1073741824), (76816896, 1207959552),
                    (76816896, 1342177280), (76816896, 1476395008), (76816896, 1610612736), (76816896, 1744830464),
                    (76816896, 1879048192), (76816896, 2013265920), (76816896, 2147483648), (76816896, 2281701376),
                    (76816896, 2415919104), (76816896, 2550136832), (76816896, 2684354560), (76816896, 2818572288),
                    (76816896, 2952790016), (76816896, 3087007744), (76816896, 3221225472), (76816896, 3355443200),
                    (76816896, 3489660928), (76816896, 3623878656), (76816896, 3758096384), (76816896, 3892314112),
                    (76816896, 4026531840), (76816896, 4160749568), (76816896, 4294967296), (76816896, 4429185024),
                    (76816896, 4563402752), (76816896, 4697620480), (76816896, 4831838208), (76816896, 4966055936),
                    (76816896, 5100273664), (76816896, 5234491392), (76816896, 5368709120), (76816896, 5502926848),
                    (76816896, 5637144576), (76816896, 5771362304), (76816896, 5905580032), (76816896, 6039797760),
                    (76816896, 6174015488), (76816896, 6308233216), (76816896, 6442450944), (76816896, 6576668672),
                    (76816896, 6710886400), (76816896, 6845104128), (76816896, 6979321856), (76816896, 7113539584),
                    (76816896, 7247757312), (76816896, 7381975040), (76816896, 7516192768), (76816896, 7650410496),
                    (76816896, 7784628224), (76816896, 7918845952), (76816896, 8053063680), (76816896, 8187281408),
                    (76816896, 8321499136), (76816896, 8388608000), (142394560, 134217728), (142394560, 268435456),
                    (142394560, 402653184), (142394560, 536870912), (142394560, 671088640), (142394560, 805306368),
                    (142394560, 939524096), (142394560, 1073741824), (142394560, 1207959552), (142394560, 1342177280),
                    (142394560, 1476395008), (142394560, 1610612736), (142394560, 1744830464), (142394560, 1879048192),
                    (142394560, 2013265920), (142394560, 2147483648), (142394560, 2281701376), (142394560, 2415919104),
                    (142394560, 2550136832), (142394560, 2684354560), (142394560, 2818572288), (142394560, 2952790016),
                    (142394560, 3087007744), (142394560, 3221225472), (142394560, 3355443200), (142394560, 3489660928),
                    (142394560, 3623878656), (142394560, 3758096384), (142394560, 3892314112), (142394560, 4026531840),
                    (142394560, 4160749568), (142394560, 4294967296), (142394560, 4429185024), (142394560, 4563402752),
                    (142394560, 4697620480), (142394560, 4831838208), (142394560, 4966055936), (142394560, 5100273664),
                    (142394560, 5234491392), (142394560, 5242880000), (522374400, 134217728), (522374400, 402653184),
                    (522374400, 671088640), (522374400, 939524096), (522374400, 1207959552), (522374400, 1476395008),
                    (522374400, 1744830464), (522374400, 2013265920), (522374400, 2281701376), (522374400, 2550136832),
                    (522374400, 2818572288), (522374400, 3087007744), (522374400, 3221225472), (522374400, 3355443200),
                    (522374400, 3489660928), (522374400, 3623878656), (522374400, 3758096384), (522374400, 3892314112),
                    (522374400, 4026531840), (522374400, 4160749568), (522374400, 4294967296), (522374400, 4429185024),
                    (522374400, 4563402752), (522374400, 4697620480), (522374400, 4831838208), (522374400, 4966055936),
                    (522374400, 5100273664), (522374400, 5234491392), (522374400, 5368709120), (522374400, 5502926848),
                    (522374400, 5637144576), (522374400, 5771362304), (522374400, 5905580032), (522374400, 6039797760),
                    (522374400, 6174015488), (522374400, 6291456000), (176576256, 3221225472), (176576256, 3355443200),
                    (176576256, 3489660928), (176576256, 3623878656), (176576256, 3758096384), (176576256, 3892314112),
                    (176576256, 4026531840), (176576256, 4160749568), (176576256, 4294967296), (176576256, 4429185024),
                    (176576256, 4563402752), (176576256, 4697620480), (176576256, 4831838208), (176576256, 4966055936),
                    (176576256, 5100273664), (176576256, 5234491392), (176576256, 5368709120), (176576256, 5502926848),
                    (176576256, 5637144576), (176576256, 5771362304), (176576256, 5905580032), (176576256, 6039797760),
                    (176576256, 6174015488), (176576256, 6308233216), (176576256, 6442450944), (176576256, 6576668672),
                    (176576256, 6710886400), (176576256, 6845104128), (176576256, 6979321856), (176576256, 7113539584),
                    (176576256, 7247757312), (176576256, 7381975040), (176576256, 7516192768), (176576256, 7650410496),
                    (176576256, 7784628224), (176576256, 7918845952), (176576256, 8053063680), (176576256, 8187281408),
                    (176576256, 8321499136), (176576256, 8455716864), (176576256, 8589934592), (176576256, 8724152320),
                    (176576256, 8858370048), (176576256, 8992587776), (176576256, 9126805504), (176576256, 9261023232),
                    (176576256, 9395240960), (176576256, 9529458688), (176576256, 9663676416), (176576256, 9797894144),
                    (176576256, 9932111872), (176576256, 10066329600), (176576256, 10200547328),
                    (176576256, 10334765056),
                    (176576256, 10468982784), (176576256, 10603200512), (176576256, 10737418240),
                    (176576256, 10871635968),
                    (176576256, 11005853696), (176576256, 11140071424), (176576256, 11274289152),
                    (176576256, 11408506880),
                    (176576256, 11542724608), (176576256, 11676942336), (176576256, 11811160064),
                    (176576256, 11945377792),
                    (176576256, 12079595520), (176576256, 12213813248), (176576256, 12348030976),
                    (176576256, 12482248704),
                    (176576256, 12582912000), (57234240, 268435456), (57234240, 402653184), (57234240, 536870912),
                    (57234240, 671088640), (57234240, 805306368), (57234240, 939524096), (57234240, 1073741824),
                    (57234240, 1207959552), (57234240, 1342177280), (57234240, 1476395008), (57234240, 1610612736),
                    (57234240, 1744830464), (57234240, 1879048192), (57234240, 2013265920), (57234240, 2147483648),
                    (57234240, 2281701376), (57234240, 2415919104), (57234240, 2550136832), (57234240, 2684354560),
                    (57234240, 2818572288), (57234240, 2952790016), (57234240, 3087007744), (57234240, 3221225472),
                    (57234240, 3355443200), (57234240, 3489660928), (57234240, 3623878656), (57234240, 3758096384),
                    (57234240, 3892314112), (57234240, 4026531840), (57234240, 4160749568), (57234240, 4194304000),
                    (57234240, 524288000), (57234240, 377487360), (295930560, 268435456), (295930560, 536870912),
                    (295930560, 805306368), (295930560, 1073741824), (295930560, 1342177280), (295930560, 1610612736),
                    (295930560, 1879048192), (295930560, 2147483648), (295930560, 2415919104), (295930560, 2684354560),
                    (295930560, 2952790016), (295930560, 3221225472), (295930560, 3489660928), (295930560, 3758096384),
                    (295930560, 4026531840), (295930560, 4294967296), (295930560, 4563402752), (295930560, 4831838208),
                    (295930560, 5100273664), (295930560, 5368709120), (295930560, 5637144576), (295930560, 5905580032),
                    (295930560, 6174015488), (295930560, 6291456000), (295930560, 134217728), (295930560, 402653184),
                    (295930560, 671088640), (295930560, 939524096), (295930560, 1207959552), (295930560, 1476395008),
                    (295930560, 1744830464), (295930560, 2013265920), (295930560, 2281701376), (295930560, 2550136832),
                    (295930560, 2818572288), (295930560, 3087007744), (295930560, 3355443200), (295930560, 3623878656),
                    (295930560, 3892314112), (295930560, 4160749568), (295930560, 4429185024), (295930560, 4697620480),
                    (295930560, 4966055936), (295930560, 5234491392), (295930560, 5502926848), (295930560, 5771362304),
                    (295930560, 6039797760), (295930560, 6308233216), (295930560, 6442450944), (295930560, 6576668672),
                    (295930560, 6710886400), (295930560, 6845104128), (295930560, 6979321856), (295930560, 7113539584),
                    (295930560, 7247757312), (295930560, 7381975040), (295930560, 7516192768), (295930560, 7650410496),
                    (295930560, 7784628224), (295930560, 7918845952), (295930560, 8053063680), (295930560, 8187281408),
                    (295930560, 8321499136), (295930560, 8455716864), (295930560, 8589934592), (295930560, 8724152320),
                    (295930560, 8858370048), (295930560, 8992587776), (295930560, 9126805504), (295930560, 9261023232),
                    (295930560, 9395240960), (295930560, 9437184000), (176576256, 6291456000), (295930560, 1572864000),
                    (418819968, 268435456), (418819968, 536870912), (418819968, 805306368), (418819968, 1073741824),
                    (418819968, 1342177280), (418819968, 1610612736), (418819968, 1879048192), (418819968, 2147483648),
                    (418819968, 2415919104), (418819968, 2684354560), (418819968, 2952790016), (418819968, 3221225472),
                    (418819968, 3489660928), (418819968, 3758096384), (418819968, 4026531840), (418819968, 4194304000),
                    (418819968, 134217728), (418819968, 402653184), (418819968, 671088640), (418819968, 939524096),
                    (418819968, 1207959552), (418819968, 1476395008), (418819968, 1744830464), (418819968, 2013265920),
                    (418819968, 2281701376), (418819968, 2550136832), (418819968, 2818572288), (418819968, 3087007744),
                    (418819968, 3355443200), (418819968, 3623878656), (418819968, 3892314112), (418819968, 4160749568),
                    (418819968, 4294967296), (418819968, 4429185024), (418819968, 4563402752), (418819968, 4697620480),
                    (418819968, 4831838208), (418819968, 4966055936), (418819968, 5100273664), (418819968, 5234491392),
                    (418819968, 5368709120), (418819968, 5502926848), (418819968, 5637144576), (418819968, 5771362304),
                    (418819968, 5905580032), (418819968, 6039797760), (418819968, 6174015488), (418819968, 6308233216),
                    (418819968, 6442450944), (418819968, 6576668672), (418819968, 6710886400), (418819968, 6845104128),
                    (418819968, 6979321856), (418819968, 7113539584), (418819968, 7247757312), (418819968, 7381975040),
                    (418819968, 7516192768), (418819968, 7650410496), (418819968, 7784628224), (418819968, 7918845952),
                    (418819968, 8053063680), (418819968, 8187281408), (418819968, 8321499136), (418819968, 8388608000),
                    (418819968, 6291456000), (176576256, 524288000), (62052928, 104857600), (57234240, 104857600),
                    (142394560, 262144000), (295930560, 524288000), (113718400, 262144000), (176576256, 262144000),
                    (76816896, 104857600), (1182757632, 268435456), (1182757632, 536870912), (1182757632, 805306368),
                    (1182757632, 1073741824), (1182757632, 1342177280), (1182757632, 1610612736),
                    (1182757632, 1879048192),
                    (1182757632, 2147483648), (1182757632, 2415919104), (1182757632, 2684354560),
                    (1182757632, 2952790016),
                    (1182757632, 3221225472), (1182757632, 3489660928), (1182757632, 3758096384),
                    (1182757632, 4026531840),
                    (1182757632, 4294967296), (1182757632, 4563402752), (1182757632, 4831838208),
                    (1182757632, 5100273664),
                    (1182757632, 5368709120), (1182757632, 5637144576), (1182757632, 5905580032),
                    (1182757632, 6174015488),
                    (1182757632, 6442450944), (1182757632, 6710886400), (1182757632, 6979321856),
                    (1182757632, 7247757312),
                    (1182757632, 7516192768), (1182757632, 7784628224), (1182757632, 8053063680),
                    (1182757632, 8321499136),
                    (1182757632, 8589934592), (1182757632, 8858370048), (1182757632, 9126805504),
                    (1182757632, 9395240960),
                    (1182757632, 9663676416), (1182757632, 9932111872), (1182757632, 10200547328),
                    (1182757632, 10468982784),
                    (1182757632, 10485760000), (76816896, 2097152000), (62052928, 1310720000), (62052928, 786432000),
                    (62052928, 209715200), (62052928, 1572864000), (62052928, 262144000), (62052928, 524288000),
                    (62052928, 1048576000), (1182757632, 10737418240), (1182757632, 11274289152),
                    (1182757632, 11811160064),
                    (1182757632, 12348030976), (1182757632, 12884901888), (1182757632, 13421772800),
                    (1182757632, 13958643712), (1182757632, 14495514624), (1182757632, 15032385536),
                    (1182757632, 15569256448), (1182757632, 16106127360), (1182757632, 16642998272),
                    (1182757632, 17179869184), (1182757632, 17716740096), (1182757632, 18253611008),
                    (1182757632, 18790481920), (1182757632, 19327352832), (1182757632, 19864223744),
                    (1182757632, 20401094656), (1182757632, 20937965568), (1182757632, 20971520000),
                    (76816896, 8455716864),
                    (76816896, 8589934592), (76816896, 8724152320), (76816896, 8858370048), (76816896, 8992587776),
                    (76816896, 9126805504), (76816896, 9261023232), (76816896, 9395240960), (76816896, 9529458688),
                    (76816896, 9663676416), (76816896, 9797894144), (76816896, 9932111872), (76816896, 10066329600),
                    (76816896, 10200547328), (76816896, 10334765056), (76816896, 10468982784), (76816896, 10603200512),
                    (76816896, 10737418240), (76816896, 10871635968), (76816896, 11005853696), (76816896, 11140071424),
                    (76816896, 11274289152), (76816896, 11408506880), (76816896, 11542724608), (76816896, 11676942336),
                    (76816896, 11811160064), (76816896, 11945377792), (76816896, 12079595520), (76816896, 12213813248),
                    (76816896, 12348030976), (76816896, 12482248704), (76816896, 12616466432), (76816896, 12750684160),
                    (76816896, 12884901888), (76816896, 13019119616), (76816896, 13153337344), (76816896, 13287555072),
                    (76816896, 13421772800), (76816896, 13555990528), (76816896, 13690208256), (76816896, 13824425984),
                    (76816896, 13958643712), (76816896, 14092861440), (76816896, 14227079168), (76816896, 14361296896),
                    (76816896, 14495514624), (76816896, 14629732352), (76816896, 14763950080), (76816896, 14898167808),
                    (76816896, 15032385536), (76816896, 15166603264), (76816896, 15300820992), (76816896, 15435038720),
                    (76816896, 15569256448), (76816896, 15703474176), (76816896, 15837691904), (76816896, 15971909632),
                    (76816896, 16106127360), (76816896, 16240345088), (76816896, 16374562816), (76816896, 16508780544),
                    (76816896, 16642998272), (76816896, 16777216000), (176576256, 4194304000), (142394560, 524288000),
                    (142394560, 2097152000), (142394560, 1048576000), (142394560, 1310720000), (142394560, 2621440000),
                    (142394560, 786432000), (142394560, 3145728000), (142394560, 1572864000), (522374400, 6442450944),
                    (522374400, 6710886400), (522374400, 6979321856), (522374400, 7247757312), (522374400, 7516192768),
                    (522374400, 7784628224), (522374400, 8053063680), (522374400, 8321499136), (522374400, 8388608000),
                    (522374400, 8589934592), (522374400, 8858370048), (522374400, 9126805504), (522374400, 9395240960),
                    (522374400, 9663676416), (522374400, 9932111872), (522374400, 10200547328),
                    (522374400, 10468982784),
                    (522374400, 10737418240), (522374400, 11005853696), (522374400, 11274289152),
                    (522374400, 11542724608),
                    (522374400, 11811160064), (522374400, 12079595520), (522374400, 12348030976),
                    (522374400, 12582912000),
                    (57234240, 1048576000), (57234240, 786432000), (76816896, 524288000), (76816896, 262144000),
                    (76816896, 786432000), (76816896, 377487360), (76816896, 1572864000), (76816896, 1048576000)]

}


def set_logging():
    logging.basicConfig(filename='D:\\CodePycharm\\LLMs-Performance-Learning\\test\\ML_SCALINGLAW_LOG.txt',
                        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s- %(funcName)s',
                        level=logging.INFO, filemode='w')


def get_whole_data(path):
    df = pd.read_csv(path)
    ndarray = df.values
    return ndarray


def get_attributes_result(data):
    X = data[:, :-1]
    Y = data[:, -1][:, np.newaxis]
    return X, Y


def get_mape(ground_truth, pre_result):
    mape_result = []
    for gt, pre in zip(ground_truth, pre_result):
        if gt == 0:
            continue
        mape = abs(gt - pre) / gt
        mape_result.append(mape)
    return np.mean(mape_result)


def get_ape_list(ground_truth, pre_result):
    mape_result = []
    for gt, pre in zip(ground_truth, pre_result):
        if gt == 0:
            continue
        mape = abs(gt - pre) / gt
        mape_result.append(mape)
    return mape_result


def plot_nd_scatter(train_df, test_df, all_point, figure_save_path=None):
    """
    train_dftest_dfND

    :
        train_df (pd.DataFrame): ND
        test_df (pd.DataFrame): ND
        figure_save_path (str): 
    """
    # train_dfN,D
    train_nd_unique = train_df[['N', 'D']].drop_duplicates()
    train_nd_list = list(train_nd_unique.itertuples(index=False, name=None))

    # test_dfN,D
    test_nd_unique = test_df[['N', 'D']].drop_duplicates()
    test_nd_list = list(test_nd_unique.itertuples(index=False, name=None))

    # 
    plt.figure(figsize=(10, 6))

    # 
    train_x = [nd[0] for nd in train_nd_list]
    train_y = [nd[1] for nd in train_nd_list]
    plt.scatter(train_x, train_y, marker='o', color='orange', label='Train')

    # 
    test_x = [nd[0] for nd in test_nd_list]
    test_y = [nd[1] for nd in test_nd_list]
    plt.scatter(test_x, test_y, marker='*', color='red', s=100, label='Test')

    unuse_nd = [nd for nd in all_point if nd not in train_nd_list and nd not in test_nd_list]
    unuse_x = [nd[0] for nd in unuse_nd]
    unuse_y = [nd[1] for nd in unuse_nd]
    plt.scatter(unuse_x, unuse_y, marker='o', color='blue', label='Unused')

    # 
    plt.title('Unique (N, D) Pairs Distribution')
    plt.xlabel('N')
    plt.ylabel('D')

    # 
    plt.legend()

    # 
    if figure_save_path is not None:
        plt.savefig(figure_save_path, dpi=300, bbox_inches='tight')

    # 
    plt.show()


def select_points(points):
    """
    points: list of tuples (c, n, d, filename)
    """

    # nd 
    def is_dominant(p, others):
        _, n_p, d_p, _ = p
        for q in others:
            _, n_q, d_q, _ = q
            if not (n_p > n_q and d_p > d_q):
                return False
        return True

    for i, p in enumerate(points):
        if is_dominant(p, points[:i] + points[i + 1:]):
            return [p]  # 

    #  c n d 
    max_c_point = max(points, key=lambda x: x[0])
    max_n_point = max(points, key=lambda x: x[1])
    max_d_point = max(points, key=lambda x: x[2])

    # 
    return list({max_c_point, max_n_point, max_d_point})


def load_data_with_mode(directory: str, indices: list, train: bool) -> pd.DataFrame:
    pattern = re.compile(r'^group_C_(.+?)_N_(.+?)_D_(.+?)\.csv$')

    file_info = []

    # 2. 
    for filename in os.listdir(directory):
        match = pattern.match(filename)
        if match:
            # c
            c_value = float(match.group(1))
            n_value = float(match.group(2))
            d_value = float(match.group(3))
            # (c, )
            file_info.append((c_value, n_value, d_value, filename))

    file_info.sort(key=lambda x: x[0])  # c

    selected_files = []
    for idx in indices:
        selected_files.append(file_info[idx])

    max_n = max(r[1] for r in file_info)
    group_n_max = [r for r in file_info if r[1] == max_n]
    point_A = max(group_n_max, key=lambda r: r[2])  #  d_value 

    # ----   d  n  ----
    max_d = max(r[2] for r in file_info)
    group_d_max = [r for r in file_info if r[2] == max_d]
    point_B = max(group_d_max, key=lambda r: r[1])  #  n_value 

    if train:
        if point_A in selected_files:
            selected_files.remove(point_A)
        if point_B in selected_files:
            selected_files.remove(point_B)
    else:
        if point_A not in selected_files:
            selected_files.append(point_A)
        if point_B not in selected_files:
            selected_files.append(point_B)

    def remove_dominated_points(records):
        """
        records: list of (c_value, n_value, d_value, filename)
        return: list of non-dominated records
        """

        non_dominated = []

        for i, A in enumerate(records):
            _, nA, dA, _ = A
            dominated = False

            for j, B in enumerate(records):
                if i == j:
                    continue

                _, nB, dB, _ = B

                #  B  A A 
                if nB >= nA and dB >= dA:
                    dominated = True
                    break

            if not dominated:
                non_dominated.append(A)

        return non_dominated

    if not train:
        selected_files = remove_dominated_points(selected_files)
    dfs = []
    for file in selected_files:
        df = pd.read_csv(os.path.join(directory, file[3]))
        dfs.append(df)

    return pd.concat(dfs, ignore_index=True)


def load_and_merge_csvs(directory: str, indices: list) -> pd.DataFrame:
    # 1. 
    #  'group_C_' , c, ,  '.csv' 
    pattern = re.compile(r'^group_C_(.+?)_N_(.+?)_D_(.+?)\.csv$')

    file_info = []

    # 2. 
    for filename in os.listdir(directory):
        match = pattern.match(filename)
        if match:
            # c
            c_value = float(match.group(1))
            n_value = float(match.group(2))
            d_value = float(match.group(3))
            # (c, )
            file_info.append((c_value, n_value, d_value, filename))

    # 3. c
    file_info.sort(key=lambda x: x[0])

    # DataFrame
    if not file_info:
        print(f" '{directory}'  'group_C_*_*.csv' ")
        return pd.DataFrame()

    # 
    sorted_filenames = [f[1] for f in file_info]

    print(f": {sorted_filenames}")

    # 4. 
    selected_files = []
    for idx in indices:
        if 0 <= idx < len(sorted_filenames):
            selected_files.append(sorted_filenames[idx])
        else:
            print(f":  {idx} ")

    if not selected_files:
        print("")
        return pd.DataFrame()

    print(f" {indices} : {selected_files}")

    # 5. CSV
    dfs_to_merge = []
    for file in selected_files:
        file_path = os.path.join(directory, file)
        try:
            df = pd.read_csv(file_path)
            dfs_to_merge.append(df)
            print(f": {file}")
        except Exception as e:
            print(f":  {file}  - {e}")

    if not dfs_to_merge:
        print("")
        return pd.DataFrame()

    # concatDataFrame
    merged_df = pd.concat(dfs_to_merge, ignore_index=True)

    print(f"DataFrame: {merged_df.shape}")

    return merged_df


def print_df_info(df: pd.DataFrame) -> None:
    """
    DataFrame
    1. ND(N,D)
    2. DataFrame
    3. DataFrame

    :
        df: pandas DataFrame

    :
        - DataFrame
        - ND
    """
    # DataFrame
    if not isinstance(df, pd.DataFrame):
        raise TypeError("pandas DataFrame")

    # ND
    required_cols = ['N', 'D']
    missing_cols = [col for col in required_cols if col not in df.columns]
    if missing_cols:
        raise ValueError(f"DataFrame{missing_cols}")

    # NDpair
    unique_pairs = df[['N', 'D']].drop_duplicates()

    # 
    print("=" * 50)
    print("1. ND(N,D)")
    print(unique_pairs.to_string(index=False))  # 

    print("\n2. DataFrame", len(df))
    print("3. DataFrame", df.shape[1])
    print("=" * 50)


def test_methods(name, trains, tests, seed):
    result_dict = {}
    time_dict = {}
    dir_path = system_dir_dict[name]

    # train_df = load_and_merge_csvs(dir_path, trains)
    # test_df = load_and_merge_csvs(dir_path, tests)
    train_df = load_data_with_mode(dir_path, trains, True)
    test_df = load_data_with_mode(dir_path, tests, False)
    fig_path = 'D:\\CodePycharm\\LLMs-Performance-Learning\\result\\test_extend\\figures'
    fig_save_path = os.path.join(fig_path, name + f'{time.time()}.png')
    # plot_nd_scatter(train_df, test_df, all_nd_pair[name], fig_save_path)
    print('------ train df ------')
    # print_df_info(train_df)
    # return
    train_np = train_df.values
    test_np = test_df.values
    train_x, train_y = get_attributes_result(train_np)
    test_x, test_y = get_attributes_result(test_np)
    logging.info(f"test data ground truth: {test_y}")
    n_train = len(train_np)

    np.random.seed(seed)
    random.seed(seed)

    logging.info(f"==== combine scaling law with part fitting & data constarin ====")
    cs2_model = None
    slpftime0 = time.time()
    mname = f'ML+SL'
    print(f"testing info: exp_name = {mname}")
    cs2_model = combine_scaling(['farseer', 'chinchilla', 'kaplan'], data_constrain=True,
                                part_scaling=True, r2_improve=True)
    cs2_model.fit(train_df)

    cs2_result = cs2_model.predict(test_df)
    slpftime = time.time() - slpftime0
    cs2_mape = get_mape(test_y, cs2_result)
    cs2_ape_list = get_ape_list(test_y, cs2_result)
    result_dict[mname] = np.ravel(cs2_ape_list)

    logging.info(f"==== farseer sacling law ====")
    ftime0 = time.time()
    farseer_model = Farseer()
    farseer_model.fit(train_df)
    farseer_result = farseer_model.predict(test_df)
    default_farseer_result = farseer_model.predict(test_df, use_default_params=True)
    ftime = time.time() - ftime0
    farseer_mape = get_mape(test_y, farseer_result)
    farseer_ape_list = get_ape_list(test_y, farseer_result)
    default_farseer_ape_list = get_ape_list(test_y, default_farseer_result)
    default_farseer_mape = get_mape(test_y, default_farseer_result)

    result_dict['farseer'] = np.ravel(farseer_ape_list)
    result_dict['d_farseer'] = np.ravel(default_farseer_ape_list)

    logging.info(f"==== Chinchilla ====")
    ctime0 = time.time()
    chinchilla_model = Chinchilla()
    chinchilla_model.fit(train_df)
    chinchilla_result = chinchilla_model.predict(test_df)
    default_chinchilla_result = chinchilla_model.predict(test_df, use_default_params=True)
    ctime = time.time() - ctime0
    default_chinchilla_mape = get_mape(test_y, default_chinchilla_result)
    chinchilla_mape = get_mape(test_y, chinchilla_result)
    chinchilla_ape_list = get_ape_list(test_y, chinchilla_result)
    default_chinchilla_ape_list = get_ape_list(test_y, default_chinchilla_result)

    result_dict['chinchilla'] = np.ravel(chinchilla_ape_list)
    result_dict['d_chinchilla'] = np.ravel(default_chinchilla_ape_list)

    logging.info(f"==== kaplan ====")
    ktime0 = time.time()
    kaplan_model = Kaplan()
    print("==============================================================")
    kaplan_model.fit(train_df)
    kaplan_result = kaplan_model.predict(test_df)
    default_kaplan_result = kaplan_model.predict(test_df, use_default_params=True)
    ktime = time.time() - ktime0
    default_kaplan_mape = get_mape(test_y, default_kaplan_result)
    kaplan_mape = get_mape(test_y, kaplan_result)
    kaplan_ape_list = get_ape_list(test_y, kaplan_result)
    default_kaplan_ape_list = get_ape_list(test_y, default_kaplan_result)

    result_dict['kaplan'] = np.ravel(kaplan_ape_list)
    result_dict['d_kaplan'] = np.ravel(default_kaplan_ape_list)

    if name == 'dense3_loss':
        manner_time0 = time.time()
        DC_model = DC_law()
        DC_model.fit(train_df)
        DC_result = DC_model.predict(test_df)
        DC_ape_list = get_ape_list(test_y, DC_result)
        manner_time = time.time() - manner_time0
        result_dict['DC_law'] = np.ravel(DC_ape_list)

    if name == 'dense4_loss':
        manner_time0 = time.time()
        mix3_model = mix3_law()
        mix3_model.fit(train_df)
        mix3_result = mix3_model.predict(test_df)
        mix3_ape_list = get_ape_list(test_y, mix3_result)
        manner_time = time.time() - manner_time0
        result_dict['mix3_law'] = np.ravel(mix3_ape_list)

    if name == 'dense5_loss':
        manner_time0 = time.time()
        mix5_model = mix5_law()
        mix5_model.fit(train_df)
        mix5_result = mix5_model.predict(test_df)
        mix5ape_list = get_ape_list(test_y, mix5_result)
        manner_time = time.time() - manner_time0
        result_dict['mix5_law'] = np.ravel(mix5ape_list)


    logging.info(f"==== random forest ====")
    rftime0 = time.time()
    rf_model = RandomForestRegressor()
    rf_model.fit(train_x, np.ravel(train_y))
    rf_result = rf_model.predict(test_x)
    rftime = time.time() - rftime0
    rf_mape = get_mape(test_y, rf_result)
    rf_ape_list = get_ape_list(test_y, rf_result)

    result_dict['rf'] = np.ravel(rf_ape_list)

    logging.info(f"==== random forest with only N, D ====")
    rfndtime0 = time.time()
    rf_ND_model = RandomForestRegressor()
    rf_ND_model.fit(train_df[['N', 'D']], np.ravel(train_y))
    rf_ND_result = rf_ND_model.predict(test_df[['N', 'D']])
    rfndtime = time.time() - rfndtime0
    rf_ND_mape = get_mape(test_y, rf_ND_result)
    rf_ND_ape_list = get_ape_list(test_y, rf_ND_result)

    result_dict['rf_nd'] = np.ravel(rf_ND_ape_list)





    return result_dict


result_dir = 'D:\\CodePycharm\\LLMs-Performance-Learning\\result\\sota2'
if __name__ == "__main__":
    seed = 43
    repeat_time = 1
    set_logging()

    for name, dir_path in system_dir_dict.items():
        if name != 'dense3_loss':
            print(name)
            seed+=1
            continue
        random.seed(seed)
        np.random.seed(seed)

        arch_rate = system_test_arch_dict[name]
        arch_len = len(os.listdir(dir_path))
        arch_indexes = list(range(arch_len))
        all_result_dict = dict()
        for r in arch_rate:
            train_len = int(arch_len * r)
            if train_len < 1:
                train_len = 1
            if train_len >= arch_len:
                train_len = arch_len - 1
            test_len = int(0.1 * arch_len)
            if test_len < 1:
                test_len = 1
            train_indexes = arch_indexes[:train_len]
            test_indexes = arch_indexes[-test_len:]
            print(f"test system {name}, test r {r}")
            result_dict = test_methods(name, train_indexes, test_indexes, seed)
            # r
            df = pd.DataFrame(result_dict)
            df.to_csv(os.path.join(result_dir, f"r_{r}_{name}.csv"), index=False)

            # 
            """for method, perf in result_dict.items():
                if method not in all_result_dict:
                    all_result_dict[method] = perf
                else:
                    all_result_dict[method].extend(perf)"""
        """all_result_df = pd.DataFrame(all_result_dict)
        all_result_df.to_csv(os.path.join(result_dir, f"{name}.csv"), index=False)"""
        seed += 1
